export type SymptomResponse = "yes" | "no" | "sometimes" | ""

interface SymptomSpec {
  question: string
  score: number
}

export const symptoms: Record<string, SymptomSpec> = {
  hot_flashes: {
    question: "Have you been experiencing hot flashes or night sweats?",
    score: 3,
  },
  irregular_periods: {
    question: "Have your menstrual periods become irregular or stopped?",
    score: 4,
  },
  sleep_issues: {
    question: "Have you been having trouble sleeping through the night?",
    score: 2,
  },
  mood_changes: {
    question: "Have you noticed significant mood swings or irritability?",
    score: 2,
  },
  vaginal_dryness: {
    question: "Have you experienced vaginal dryness or discomfort during intercourse?",
    score: 2,
  },
  libido_changes: {
    question: "Have you noticed changes in your sexual desire?",
    score: 1,
  },
  memory_focus: {
    question: "Have you had problems with memory or concentration?",
    score: 1,
  },
  weight_changes: {
    question: "Have you experienced unexplained weight gain, especially around the abdomen?",
    score: 1,
  },
  hair_changes: {
    question: "Have you noticed thinning hair or dry skin?",
    score: 1,
  },
  joint_pain: {
    question: "Have you been experiencing joint pain or stiffness?",
    score: 1,
  },
}

export function calculateScore(responses: Record<string, SymptomResponse>): number {
  let total = 0
  Object.entries(responses).forEach(([key, value]) => {
    if (!value || value === "no") return
    const spec = symptoms[key]
    if (spec) {
      // “sometimes” counts the same as “yes” per original spec
      total += spec.score
    }
  })
  return total
}

export function generateAssessment(score: number) {
  if (score === 0)
    return {
      stage: "No symptoms",
      message: "You're not reporting any common menopausal symptoms.",
      detailed_message:
        "Based on your responses, you don't appear to be experiencing typical menopause symptoms at this time.",
    }
  if (score <= 5)
    return {
      stage: "Mild symptoms",
      message: "You're reporting some mild symptoms that could be related to perimenopause.",
      detailed_message: "These might be worth discussing with your healthcare provider if they concern you.",
    }
  if (score <= 10)
    return {
      stage: "Perimenopause/Early menopause",
      message: "You're reporting several symptoms commonly associated with menopause.",
      detailed_message:
        "This suggests you may be in perimenopause or early menopause. Consider consulting with a healthcare provider about managing these symptoms.",
    }
  return {
    stage: "Significant menopausal symptoms",
    message: "You're reporting multiple significant menopausal symptoms.",
    detailed_message:
      "This strongly suggests you may be experiencing menopause. A healthcare provider can help confirm this and discuss treatment options.",
  }
}
